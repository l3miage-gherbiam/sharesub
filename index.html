<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ShareSub Manager — Abonnements & Abonnés</title>
  <style>
    :root{
      --bg:#f8fafc; --panel:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb;
      --brand:#2563eb; --brand2:#60a5fa; --green:#16a34a; --red:#ef4444; --amber:#f59e0b; --violet:#7c3aed;
      --pill:#eef2ff; --chip:#f1f5f9; --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.5 system-ui,Segoe UI,Roboto,Inter,Arial}
    header{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:12px 16px;background:linear-gradient(180deg,#ffffffee,#ffffffdd);backdrop-filter:saturate(1.2) blur(6px);
      border-bottom:1px solid var(--line)}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--brand2),var(--brand));
      display:grid;place-items:center;color:#fff;font-weight:900}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    button,.btn,input[type=file]{border:1px solid var(--line);background:#f8fafc;color:var(--ink);
      padding:10px 12px;border-radius:10px;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,var(--brand2),var(--brand));color:#fff;border:0;font-weight:700}
    .btn.success{background:linear-gradient(135deg,#86efac,#22c55e);border:0;color:#064e3b}
    .btn.danger{background:linear-gradient(135deg,#fecaca,#ef4444);border:0;color:#7f1d1d}
    main{padding:16px;max-width:1100px;margin:0 auto}
    h2{margin:12px 0}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:14px;margin-bottom:14px;box-shadow:0 1px 2px rgba(15,23,42,.06)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .kpi{flex:1 1 220px;background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px}
    .kpi small{color:var(--muted)} .money{font-variant-numeric:tabular-nums}
    /* accordions */
    details{border:1px solid var(--line);border-radius:12px;background:#fff;margin-bottom:10px}
    summary{cursor:pointer;padding:12px 14px;list-style:none;display:flex;align-items:center;gap:10px}
    summary::-webkit-details-marker{display:none}
    details > div{padding:10px 14px;border-top:1px solid var(--line);background:#fbfcff}
    .muted{color:var(--muted)} .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .tag{display:inline-flex;align-items:center;gap:6px;background:var(--pill);border:1px solid #e0e7ff;padding:6px 10px;border-radius:999px}
    .chip{display:inline-flex;align-items:center;gap:6px;background:var(--chip);padding:6px 10px;border-radius:999px}
    .pill{padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#fff}
    /* grid meta */
    .meta{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin:8px 0 12px}
    .meta .box{border:1px dashed var(--line);border-radius:10px;padding:10px;background:#fff}
    .meta .label{color:var(--muted);font-size:12px}
    /* tables */
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 12px;border-bottom:1px solid var(--line);text-align:left;vertical-align:top}
    thead th{color:var(--muted);font-weight:600}
    .right{text-align:right}
    /* modal */
    dialog{border:1px solid var(--line);background:#fff;border-radius:16px;padding:0;width:min(720px,96vw)}
    dialog::backdrop{background:rgba(0,0,0,.35)}
    .modal-head{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .modal-body{padding:14px}
    .modal-foot{display:flex;gap:8px;justify-content:flex-end;padding:10px 14px;border-top:1px solid var(--line)}
    .grid-2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .field{display:flex;flex-direction:column;gap:6px}
    label{color:var(--muted);font-size:12px}
    input,textarea,select{border:1px solid var(--line);background:#fff;color:#0f172a;border-radius:10px;padding:10px 12px;outline:none}
    .pwd-wrap{display:flex;align-items:center;gap:8px}
    .reveal{border:1px solid var(--line);background:#f3f4f6;border-radius:8px;padding:6px 8px;cursor:pointer}
    /* toggle */
    .toggle{appearance:none;width:44px;height:24px;border-radius:999px;position:relative;outline:none;cursor:pointer;
      background:#e5e7eb;border:1px solid var(--line)}
    .toggle:checked{background:#93c5fd}
    .toggle:before{content:"";position:absolute;top:2px;left:2px;width:20px;height:20px;background:#fff;border-radius:50%;
      transition:transform .18s ease}
    .toggle:checked:before{transform:translateX(20px)}
    @media (max-width:720px){ .meta{grid-template-columns:1fr} .grid-2{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <header>
    <div class="brand"><div class="logo">S</div><strong>ShareSub Manager</strong> <span class="chip">🎛️ Abonnements & 👥 Abonnés</span></div>
    <div class="toolbar">
      <label class="btn">📥 Importer JSON <input id="importFile" type="file" accept=".json" style="display:none"></label>
      <button class="btn" id="exportBtn">📤 Exporter JSON</button>
      <button class="btn success" id="addAccountBtn">➕ Ajouter compte</button>
      <button class="btn primary" id="resetBtn" title="Réinitialise avec l'exemple">♻️ Reset (exemple)</button>
    </div>
  </header>

  <main>
    <!-- KPIs -->
    <section class="row">
      <div class="kpi"><small>💶 Revenu / mois</small><div class="money" id="kpiRevenue">—</div></div>
      <div class="kpi"><small>💳 Coût / mois</small><div class="money" id="kpiCost">—</div></div>
      <div class="kpi"><small>📈 Marge / mois</small><div class="money" id="kpiMargin">—</div></div>
      <div class="kpi"><small>🗂️ Comptes</small><div id="kpiAccounts">—</div></div>
    </section>

    <!-- Comptes ShareSub -->
    <section class="card">
      <h2>🗂️ Comptes ShareSub</h2>
      <div id="accountsList"><!-- rendu JS --></div>
    </section>

    <!-- Mails (activation + pays) -->
    <section class="card">
      <h2>📧 Mails</h2>
      <div class="row" style="justify-content:flex-end;gap:6px;margin-bottom:8px">
        <button class="btn success" id="addEmailBtn">➕ Ajouter mail</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Adresse</th>
            <th>Pays</th>
            <th>Activé ?</th>
            <th>Dernier check</th>
            <th class="right">Actions</th>
          </tr>
        </thead>
        <tbody id="emailRows"><!-- rendu JS --></tbody>
      </table>
    </section>
  </main>

  <!-- Modals -->
  <dialog id="accountModal">
    <div class="modal-head"><strong id="accTitle">Nouveau compte</strong><button class="btn" onclick="closeDlg(this)">✖</button></div>
    <div class="modal-body">
      <div class="grid-2">
        <div class="field"><label>Nom du compte</label><input id="acc_name" placeholder="ShareSub #1"></div>
        <div class="field"><label>Pays</label><input id="acc_country" placeholder="FR"></div>
        <div class="field"><label>Email du compte</label><input id="acc_email" type="email" placeholder="owner@example.com"></div>
        <div class="field"><label>IBAN (masqué)</label><input id="acc_iban" placeholder="FR76••••1234"></div>
        <div class="field"><label>Revenu /mois</label><input id="acc_rev" type="number" step="0.01" placeholder="0.00"></div>
        <div class="field"><label>Coût /mois</label><input id="acc_cost" type="number" step="0.01" placeholder="0.00"></div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn" onclick="closeDlg(this)">Annuler</button>
      <button class="btn primary" id="accSaveBtn">Enregistrer</button>
    </div>
  </dialog>

  <dialog id="subModal">
    <div class="modal-head"><strong id="subTitle">Nouvel abonnement</strong><button class="btn" onclick="closeDlg(this)">✖</button></div>
    <div class="modal-body">
      <div class="grid-2">
        <div class="field"><label>Plateforme</label><input id="sub_platform" placeholder="spotify / youtube / netflix"></div>
        <div class="field"><label>Plan</label><input id="sub_plan" placeholder="Famille / Premium"></div>
        <div class="field"><label>📧 Mail de l’abonnement</label><input id="sub_mail" type="email" placeholder="mail du compte"></div>
        <div class="field"><label>🔒 Mot de passe</label><div class="pwd-wrap"><input id="sub_pwd" type="password" placeholder="••••••"><button class="reveal" onclick="toggleFieldPwd('sub_pwd',this)">👁️</button></div></div>
        <div class="field"><label>💶 Prix (tu payes /mois)</label><input id="sub_price" type="number" step="0.01" placeholder="0.00"></div>
        <div class="field"><label>📅 Date de renouvellement</label><input id="sub_renew" type="date"></div>
        <div class="field" style="grid-column:1/-1"><label>📝 Commentaire</label><textarea id="sub_comment" rows="3" placeholder="Infos, notes, consignes…"></textarea></div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn" onclick="closeDlg(this)">Annuler</button>
      <button class="btn primary" id="subSaveBtn">Enregistrer</button>
    </div>
  </dialog>

  <dialog id="memberModal">
    <div class="modal-head"><strong id="memTitle">Nouvel abonné</strong><button class="btn" onclick="closeDlg(this)">✖</button></div>
    <div class="modal-body">
      <div class="grid-2">
        <div class="field"><label>🧑 Pseudo</label><input id="mem_pseudo" placeholder="Pseudo Spliiit"></div>
        <div class="field"><label>📧 Mail</label><input id="mem_mail" type="email" placeholder="email@domaine.com"></div>
        <div class="field"><label>💶 Prix payé /mois</label><input id="mem_fee" type="number" step="0.01" placeholder="0.00"></div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn" onclick="closeDlg(this)">Annuler</button>
      <button class="btn primary" id="memSaveBtn">Enregistrer</button>
    </div>
  </dialog>

  <dialog id="emailModal">
    <div class="modal-head"><strong id="emailTitle">Nouveau mail</strong><button class="btn" onclick="closeDlg(this)">✖</button></div>
    <div class="modal-body">
      <div class="grid-2">
        <div class="field"><label>📧 Adresse</label><input id="em_address" type="email" placeholder="support@slicesub.com"></div>
        <div class="field"><label>🌍 Pays</label><input id="em_country" placeholder="FR"></div>
        <div class="field"><label>✅ Activé ?</label>
          <select id="em_enabled"><option value="true">Oui</option><option value="false" selected>Non</option></select>
        </div>
        <div class="field"><label>🕒 Dernier check (optionnel)</label><input id="em_last" placeholder="2025-08-26 12:00"></div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn" onclick="closeDlg(this)">Annuler</button>
      <button class="btn primary" id="emailSaveBtn">Enregistrer</button>
    </div>
  </dialog>

  <script src="app.js"></script>
</body>
</html>
